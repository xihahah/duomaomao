var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function h(t){try{a(n["throw"](t))}catch(e){o(e)}}function a(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,h)}a((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){a.label=i[1];break}if(6===i[0]&&a.label<s[1]){a.label=s[1],s=i;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(i);break}s[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(n){i=[6,n],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,s,h,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},Scene=function(t){function e(){var e=t.call(this)||this;return e.person=[],e.roomBox=[],e.textureArr=[],e._bullet=[],e.stickers=[],e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.hitTest=function(t,e){var i=t.x,n=t.y;this.checkAnchor(t)&&(i=t.x-t.width/2,n=t.y-t.height/2);var r=i+t.width,o=n+t.height,s=e.x-e.anchorOffsetX,h=e.y-e.anchorOffsetY;return r>s&&i<s+e.width&&o>h&&n<h+e.height?!0:!1},e.prototype.intersectTest=function(t,e){var i=0,n=0;this.checkAnchor(t)?i=t.height/2:(i=t.height,n=t.width/2);var r=t.x-t.anchorOffsetX+n,o=t.y-t.anchorOffsetY+i,s=e.x-e.anchorOffsetX,h=e.y-e.anchorOffsetY;return o>=h&&o<h+e.height&&r>s&&r<s+e.width?!0:!1},e.prototype.getByName=function(t,e){for(var i=[],n=0;n<t.numChildren;n++)t.getChildAt(n).name==e&&i.push(t.getChildAt(n));return i},e.prototype.boxTest=function(t){for(var e=this.getChildAt(t.roomNum),i=[],n=0;n<e.numChildren;n++){var r=e.getChildAt(n),o=new egret.DisplayObject;o.x=e.x+r.x,o.y=e.y+r.y,o.width=r.width,o.height=r.height,o.anchorOffsetX=r.anchorOffsetX,o.anchorOffsetY=r.anchorOffsetY,o.name=r.name,this.intersectTest(t,o)&&i.push(o)}return i},e.prototype.checkRoom=function(t){for(var e=0;e<this.numChildren;e++)if("room"==this.getChildAt(e).name){var i=this.intersectTest(t,this.getChildAt(e));if(i&&t.roomNum!=e){if(t.type==playType.mouse)for(var n=this.roomBox[t.roomNum-1],r=n.length-1;r>=0;r--)if(n[r]==t){n.splice(r,1);break}t.roomNum=e,this.roomBox[t.roomNum-1].push(t);break}}},e.prototype.random_texture=function(){for(var t=this.random(1,this.textureArr.length-1);this.textureArr[t].length<1;)t=this.random(1,this.textureArr.length-1);var e=this.random(0,this.textureArr[t].length-1);return{a:t,b:e}},e.prototype.random_roomnum=function(){return this.random(1,this.rooms)},e.prototype.random_position=function(){var t=this.random_roomnum(),e=this.getChildAt(t),i=this.random(e.x,e.x+e.width-50),n=e.y+e.height-80;return{x:i,y:n,nr:t}},e.prototype.random_roomposition=function(t){void 0==t&&(t=this.random_roomnum());var e=this.getChildAt(t),i=e.getChildAt(this.random(0,e.numChildren-1)),n=this.random(e.x+i.x,e.x+i.x+i.width),r=e.y+i.y;return{x:n,y:r,nr:t}},e.prototype.random=function(t,e){return Math.round(Math.random()*(e-t)+t)},e.prototype.checkAnchor=function(t){return t.type==playType.cat?!0:!1},e}(eui.Component);__reflect(Scene.prototype,"Scene");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?n(r):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.scene=new startScene,e.ms=new mainScene,e.mcs=new matchScene,e.initRespone=function(t){200==t?(e.scene.setText("初始化成功"),GameData.engine.registerUser()):e.scene.setText("初始化失败")},e.registerRespone=function(t){0==t.status?(e.scene.setText("注册成功！"),e.scene.setUser(t),GameData.engine.login(t.id,t.token,"deviceID")):e.scene.setText("注册失败！")},e.loginResponse=function(t){200==t.status?e.scene.setText("登陆成功！"):e.scene.setText("登陆失败！")},e.joinResponse=function(t,i,n){200==t?(e.scene.setText("已加入房间"),e.scene.setText(n.roomID)):e.scene.setText("加入失败，请重试")},e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),[4,RES.getResByUrl("resource/assets/images/zit.fnt",this.onLoadFont,this,RES.ResourceItem.TYPE_FONT)];case 4:return i.sent(),this.stage.removeChild(t),[3,6];case 5:return e=i.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.onLoadFont=function(t){font=t},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.addChild(new gameScene),this.createData()},e.prototype.createData=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.gs=new gameScene,this.addChild(this.gs),[4,this.gs.createGame()];case 1:return t.sent(),this.gs.init(),[2]}})})},e.prototype.switchScene=function(){this.addChild(this.mcs)},e.prototype.backScene=function(){this.ms.playTG(),this.removeChild(this.mcs)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function r(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var h=t.split("/");h.pop();var a=h.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(n,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Bullet=function(t){function e(e){var i=t.call(this)||this;return i.isUse=!1,i.width=GameData.gameconfig.bwidth,i.height=GameData.gameconfig.bheight,i._main=e,i._bulletImg=new eui.Image,i._bulletImg.width=i.width,i._bulletImg.height=i.height,i.addChild(i._bulletImg),i}return __extends(e,t),e.prototype.frame=function(){this.isUse&&this.btype==playType.cat&&(this.x+=this._speed,this.x==this.endX&&this.recycle())},e.prototype.use=function(t,e,i,n){this.isUse=!0,this.x=e-30*n,this.y=i,this.btype=t,this._speed=-15*n,this.endX=this.x+20*this._speed,t==playType.cat&&(this._bulletImg.source="attackTextrue_png"),this._main.addChild(this),this.addEventListener(egret.Event.ENTER_FRAME,this.frame,this)},e.prototype.recycle=function(){this.isUse=!1,this._main.removeChild(this),this.removeEventListener(egret.Event.ENTER_FRAME,this.frame,this)},e}(eui.Component);__reflect(Bullet.prototype,"Bullet");var Camera=function(t){function e(e,i){var n=t.call(this)||this;return n.m_width=e,n.m_height=i,n.m_cameraOffsetX=0,n.m_cameraOffsetY=0,n}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(t){this.m_container=t,this.m_zoomX=this.m_container.x,this.m_zoomY=this.m_container.y},e.prototype.setAnchor=function(){null!=this.m_container&&(this.setPosition(),this.m_zoomX=this.m_follower.x,this.m_zoomY=this.m_follower.y)},e.prototype.setPosition=function(){var t=this.m_container.getChildAt(this.m_follower.roomNum),e=t.y,i=e+t.height-this.m_height,n=t.x,r=n+t.width-this.m_width,o=this.m_follower.x-this.m_width/2,s=this.m_follower.y-this.m_height/2;n>o?o=n:o>r&&(o=r),e>s?s=e:s>i&&(s=i),this.m_container.x=-o,this.m_container.y=-s},e.prototype.setZoom=function(t){null!=this.m_container&&(this.m_container.scaleX=t,this.m_container.scaleY=t)},e.prototype.setRotation=function(t){null!=this.m_container&&(this.m_container.rotation=t)},e.prototype.follow=function(t){null!=this.m_container&&(this.m_follower=t,this.m_zoomX=this.m_follower.x,this.m_zoomY=this.m_follower.y,this.m_cameraOffsetY=this.m_follower.speedY,this.setAnchor())},e.prototype.followCenterX=function(){var t=this.x-this.m_container.x+this.m_width/2-10,e=this.x-this.m_container.x+this.m_width/2+10;return this.m_cameraOffsetX>0&&this.m_follower.x>e||this.m_cameraOffsetX<0&&this.m_follower.x<t?!0:!1},e.prototype.cameraMove=function(){this.m_cameraOffsetX=this.m_follower.speedX*this.m_follower.dir,this.addEventListener(egret.Event.ENTER_FRAME,this.move,this)},e.prototype.cStopMove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this)},e.prototype.cameraFall=function(){var t=this.m_container.getChildAt(this.m_follower.roomNum),e=t.y+t.height,i=this.y-this.m_container.y,n=this.m_follower,r=Math.round(this.y+this.m_height/3*2-this.m_container.y);i<e-this.m_height&&n.y>r&&(this.m_container.y-=this.m_cameraOffsetY)},e.prototype.cameraUp=function(){var t=this.m_container.getChildAt(this.m_follower.roomNum),e=t.y,i=(t.y+t.height,this.m_follower.y),n=Math.round(this.y+this.m_height/3-this.m_container.y),r=Math.round(this.y+this.m_height/3*2-this.m_container.y);Math.round(this.y+this.m_height-this.m_container.y);if(n>i){var o=this.y-this.m_container.y-e<r-this.m_follower.y?this.y-this.m_container.y-e:r-this.m_follower.y;egret.Tween.get(this.m_container).to({y:this.m_container.y+o},500)}},e.prototype.move=function(){var t=this.m_container.x,e=t+this.m_container.width,i=0,n=this.m_width;(this.m_cameraOffsetX>0&&e>n&&this.followCenterX()||this.m_cameraOffsetX<0&&i>t&&this.followCenterX())&&(this.m_container.x-=this.m_cameraOffsetX)},e}(eui.Component);__reflect(Camera.prototype,"Camera",["eui.UIComponent","egret.DisplayObject"]);var Player=function(t){function e(){var e=t.call(this)||this;return e.dir=-1,e.mc=new egret.MovieClip,e.addChild(e.mc),e}return __extends(e,t),e.prototype.init=function(){var t=new egret.MovieClipDataFactory(RES.getRes("cat_mc_json"),RES.getRes("cat_tex_png"));this.mc.setMovieClipData(t.generateMovieClipData("猫猫动画")),this.width=this.mc.width,this.height=this.mc.height,this.anchorOffsetX=0,this.anchorOffsetY=0,this.jumpSpeed=GameData.gameconfig.pjumpspeed,this.speedX=GameData.gameconfig.pspeedx,this.speedY=GameData.gameconfig.pspeeedy,this.scaleX=1,this.canFall=!0,this.isJump=!1},e.prototype.scale=function(){this.scaleX=this.dir>0?-1:1},e.prototype.playMC=function(){this.mc.isPlaying||this.mc.gotoAndPlay(0,-1)},e.prototype.moveX=function(){this.parent&&this.x>this.parent.x-this.speedX*this.dir&&this.x<this.parent.width-this.speedX*this.dir&&(this.x+=this.speedX*this.dir)},e.prototype.jump=function(){var t=this;this.isJump||(this.isJump=!0,egret.Tween.get(this).to({y:this.y-this.jumpSpeed},500,egret.Ease.quartOut).call(function(){t.canFall=!0,t.addEventListener(egret.Event.ENTER_FRAME,t.fall,t)}))},e.prototype.fall=function(){var t=this.parent.getChildAt(this.roomNum),e=t.y+t.height;this.canFall&&this.y<e&&(this.y+=this.speedY)},e.prototype.startMove=function(){this.type==playType.cat&&this.scale(),this.playMC(),this.addEventListener(egret.Event.ENTER_FRAME,this.moveX,this)},e.prototype.stopMoveX=function(){this.mc.gotoAndStop(0),this.removeEventListener(egret.Event.ENTER_FRAME,this.moveX,this)},e.prototype.chage=function(){this.removeChild(this.mc),this.playObj=new eui.Image(this.ptexture),this.playObj.width=this.ptexture.textureWidth,this.playObj.height=this.ptexture.textureHeight,this.width=this.playObj.width,this.height=this.playObj.height,this.y-=this.mc.height/2,this.addChild(this.playObj)},e.prototype.back=function(){this.removeChild(this.playObj),this.width=this.mc.width,this.height=this.mc.height,this.addChild(this.mc)},e.prototype.setHitobj=function(t,e){null==this.hitBox&&(this.hitBox=t,this.hitBoxIndex=e,this.hitBox.addfilter(),this.addEventListener(egret.Event.ENTER_FRAME,this.checkHit,this))},e.prototype.checkHit=function(){var t=this.parent;t&&(t.hitTest(this,this.hitBox)||(this.hitBox.removefilter(),this.hitBox=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.checkHit,this)))},e.prototype.takeup=function(){var t=this.parent;if(null==this.carryObj){if(null==this.hitBox)return;this.carryObj=this.hitBox,t.roomBox[t.player.roomNum-1].splice(this.hitBoxIndex,1),this.addEventListener(egret.Event.ENTER_FRAME,this.carryMove,this)}else this.removeEventListener(egret.Event.ENTER_FRAME,this.carryMove,this),this.carryObj.roomNum=t.player.roomNum,t.roomBox[this.carryObj.roomNum-1].push(this.carryObj),this.carryObj.checkFall(),this.carryObj=null},e.prototype.putoff=function(){this.carryObj=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.carryMove,this)},e.prototype.carryMove=function(){this.carryObj.x=this.x,this.carryObj.y=this.y-this.carryObj.height},e}(eui.Component);__reflect(Player.prototype,"Player");var GameData=function(){function t(){}return t.channel="Matchvs",t.environment={dev:"alpha",pro:"release"},t.GameID=217622,t.Appkey="fe20841e73df41d794f15891c940a306#E",t.Secret="233020558933484a97895e34eaf1589a",t.GameVersion=1,t.engine=new MatchvsEngine,t.response=new MatchvsResponse,t.stageWidth=1136,t.stageHeight=640,t.gameconfig={bNum:20,bwidth:30,bheight:30,pNum:4,pspeedx:10,pspeeedy:10,pjumpspeed:150,sNum:4},t.fixedType={room:"room",nfloor:"newFloor"},t}();__reflect(GameData.prototype,"GameData");var playType;!function(t){t[t.cat=0]="cat",t[t.mouse=1]="mouse",t[t.box=2]="box"}(playType||(playType={}));var font,gamedata={},scene1=function(t){function e(){var e=t.call(this)||this;return e.gamedata=GameData.gameconfig,e._sTexture={1:"s1l1_json",2:null,3:"s1r1_json",4:"s1l2_json",5:"s1r2_json"},e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rooms=this.findRoom();for(var e=0;e<this.rooms;e++)this.roomBox[e]=[];this.getTexture(),this.initPool()},e.prototype.init=function(){this.createNPC(gamedata.sbox),this.createSticker(),this.createPlayer()},e.prototype.getTexture=function(){for(var t in this._sTexture)if(this.textureArr[t]=[],null!=this._sTexture[t]){var e=RES.getRes(this._sTexture[t])._textureMap;for(var i in e)this.textureArr[t].push(e[i])}},e.prototype.createNPC=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=new SmallObj(this);n.setView(this.textureArr[i.texture.a][i.texture.b]),n.roomNum=i.roomNum,n.x=i.x-n.width,n.y=i.y-n.height,this.roomBox[n.roomNum-1].push(n),this.addChild(n)}},e.prototype.createPlayer=function(){for(var t=gamedata.person,e=0;e<t.length;e++){var i=new Player;i.init(),i.roomNum=t[e].roomNum,i.x=t[e].x,i.y=t[e].y,i.type=t[e].type,i.type!=playType.cat&&(i.ptexture=this.textureArr[t[e].playObj.a][t[e].playObj.a],i.chage(),this.roomBox[i.roomNum-1].push(i)),this.person.push(i),this.addChild(i),console.log(i.roomNum)}this.player=this.person[0]},e.prototype.setplayer=function(t){this.player=this.person[t]},e.prototype.initPool=function(){for(var t=0;t<this.gamedata.bNum;t++){var e=new Bullet(this);this._bullet.push(e)}},e.prototype.getBullet=function(){for(var t=0;t<this._bullet.length;t++)if(0==this._bullet[t].isUse)return this._bullet[t];console.log("子弹已经用光")},e.prototype.findRoom=function(){for(var t=0,e=0;e<this.numChildren;e++)this.getChildAt(e).name==GameData.fixedType.room&&t++;return t},e.prototype.createSticker=function(){for(var t=gamedata.sticker,e=0;e<t.length;e++){var i=new Sticker(this),n=t[e].texture;i.addMask(this.textureArr[n.a][n.b]),i.x=t[e].x-i.width,i.y=t[e].y-i.height,i.roomNum=t[e].roomNum,this.stickers.push(i),this.addChild(i)}},e}(Scene);__reflect(scene1.prototype,"scene1",["eui.UIComponent","egret.DisplayObject"]);var SmallObj=function(t){function e(e){var i=t.call(this)||this;return i.isUse=!1,i.anchorOffsetX=0,i.anchorOffsetY=0,i._main=e,i._displayView=new eui.Image,i.type=playType.box,i.addChild(i._displayView),i}return __extends(e,t),e.prototype.setView=function(t){this._displayView.source=t,this.width=t.textureWidth,this.height=t.textureHeight},e.prototype.addfilter=function(){var t=[1,0,0,0,100,0,1,0,0,100,0,0,1,0,100,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);this.filters=[e]},e.prototype.checkHit=function(){var t=this.parent;t&&(t.hitTest(this.hitObj,this)||(this.removefilter(),this.hitObj=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.checkHit,this)))},e.prototype.removefilter=function(){this.filters=null},e.prototype.checkFall=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.fall,this),this.dispatchEvent(new egret.Event("soFall"))},e.prototype.fall=function(){var t=this.parent;t&&(t.boxTest(this).length>0?this.removeEventListener(egret.Event.ENTER_FRAME,this.fall,this):this.y+=5)},e}(eui.Component);__reflect(SmallObj.prototype,"SmallObj");var Sticker=function(t){function e(e){var i=t.call(this)||this;return i._main=e,i.anchorOffsetX=0,i.anchorOffsetY=0,i._tip=new eui.Image("tip_png"),i}return __extends(e,t),e.prototype.addMask=function(t){this._displayView=new eui.Image,this._texture=t,this._displayView.source=t,this._displayView.width=t.textureWidth,this._displayView.height=t.textureHeight,this._displayView.x=0,this._displayView.y=0,this.width=this._displayView.width,this.height=this._displayView.height,this.maskRect=new eui.Rect(this._displayView.width,this._displayView.height,4473410),this.maskRect.mask=this._displayView,this.maskRect.x=0,this.maskRect.y=0,this.addChild(this.maskRect),this.addChild(this._displayView),this.addEventListener(egret.Event.ENTER_FRAME,this.stickerHit,this)},e.prototype.removeMask=function(){this.maskRect.mask=null,this.removeChild(this.maskRect),this.removeEventListener(egret.Event.ENTER_FRAME,this.stickerHit,this)},e.prototype.showTip=function(){this.addChild(this._tip),this._tip.y=-this._tip.height,this._tip.x=-this._tip.width/2+this._displayView.width/2},e.prototype.hidTip=function(){this.removeChild(this._tip)},e.prototype.showResult=function(){this._tipr=new eui.Image("tipr_png"),this.addChild(this._tipr),this._tipr.y=-this._tipr.height,this._tipr.x=-this._tipr.width/2+this._displayView.width/2},e.prototype.stickerHit=function(){if(null==this.hitPerson){for(var t in this._main.person)if(this._main.hitTest(this._main.person[t],this)&&this._main.person[t].type==playType.mouse){this.hitPerson=t,null!=this._main.person[t].carryObj&&(this.compareObj=this._main.person[t].carryObj),this.showTip();break}}else null==this._main.person[this.hitPerson].carryObj&&null!=this.compareObj&&this._main.hitTest(this.compareObj,this)&&this.compare(),this._main.hitTest(this._main.person[this.hitPerson],this)||(this.hidTip(),this.hitPerson=null)},e.prototype.compare=function(){this.compareObj._displayView.source==this._texture&&(this.removeMask(),this.showResult(),this._main.roomBox[this.compareObj.roomNum-1].pop(),this._main.removeChild(this.compareObj))},e}(eui.Component);__reflect(Sticker.prototype,"Sticker");var Timer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._text=new egret.BitmapText,this._text.font=font,this.addChild(this._text),this._timer=new egret.Timer(1e3)},e.prototype.startTimer=function(t){this._initTime=t,this.showText(this._initTime),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start()},e.prototype.onTimer=function(){this._initTime>0?(this._initTime--,this.showText(this._initTime)):this.onComplete()},e.prototype.onComplete=function(){this._timer.stop(),console.log("时间到！")},e.prototype.showText=function(t){var e=Math.floor(t/60),i=t-60*e;this._text.text=e+":"+i},e}(eui.Component);__reflect(Timer.prototype,"Timer",["eui.UIComponent","egret.DisplayObject"]);var gameScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.createGame=function(){gamedata.scene=1,this.createGS();for(var t=[],e=[],i=[],n=GameData.gameconfig.pNum,r=this.scene.random(0,n-1),o=0;n>o;o++){var s=new Object,h=this.scene.random_position();s.roomNum=h.nr,s.x=h.x,s.y=h.y,o!=r?(s.type=playType.mouse,s.playObj=this.scene.random_texture()):s.type=playType.cat,e.push(s)}gamedata.person=e;for(var o=0;o<this.scene.rooms;o++){if(this.scene.textureArr[o+1].length>0){var a=new Object,c=this.scene.random(0,this.scene.textureArr[o+1].length-1);a.texture={a:o+1,b:c},a.roomNum=o+1;var h=this.scene.random_roomposition(a.roomNum);a.x=h.x,a.y=h.y,i.push(a);var p=new Object;p.texture=a.texture;for(var l=this.scene.random_roomposition();l.nr==o+1;)l=this.scene.random_roomposition();p.roomNum=l.nr,p.x=l.x,p.y=l.y,t.push(p)}for(var u=this.scene.random(4,12),m=0;u>m;m++){var d=new Object;d.texture=this.scene.random_texture(),d.roomNum=o+1;var h=this.scene.random_roomposition(d.roomNum);d.x=h.x,d.y=h.y,t.push(d)}}gamedata.sticker=i,gamedata.sbox=t},e.prototype.createGS=function(){switch(gamedata.scene){case 1:this.scene=new scene1}this.addChild(this.scene)},e.prototype.init=function(){this.scene.init(),this.camera=new Camera(GameData.stageWidth,GameData.stageHeight),this.camera.init(this.scene),this.camera.follow(this.scene.player),this.addChild(this.camera),this.setChildIndex(this.controlGroup,999),this.roomHide(),this.jumpFrame(),this.initEvent()},e.prototype.initEvent=function(){var t=this;this.leftBtn.addEventListener("touchBegin",this.handleLeft,this),this.leftBtn.addEventListener("touchReleaseOutside",this.handleMoveEnd,this),this.leftBtn.addEventListener("touchEnd",this.handleMoveEnd,this),this.rightBtn.addEventListener("touchBegin",this.handleRight,this),this.rightBtn.addEventListener("touchReleaseOutside",this.handleMoveEnd,this),this.rightBtn.addEventListener("touchEnd",this.handleMoveEnd,this),this.upBtn.addEventListener("touchBegin",this.handleUp,this),this.attackBtn.addEventListener("touchBegin",this.handleAttack,this),this.carryBtn.addEventListener("touchBegin",this.handleCarry,this),document.addEventListener("keydown",function(e){return t.handleKeydown(e)},!1),document.addEventListener("keyup",function(e){return t.handleKeyup(e)},!1)},e.prototype.moveFrame=function(){this.scene.checkRoom(this.scene.player);var t=this.scene.boxTest(this.scene.player);t.length<=0&&(this.scene.player.canFall=!0,this.jumpFrame()),this.checkHit()},e.prototype.jumpFrame=function(){if(this.checkHit(),this.scene.player.canFall){this.camera.cameraFall();var t=void 0;if(t=this.scene.boxTest(this.scene.player),t.length>0){this.scene.player.canFall=!1,this.scene.player.isJump=!1,this.camera.cameraUp();for(var e=0;e<t.length;e++)t[e].name&&t[e].name==GameData.fixedType.nfloor&&egret.Tween.get(this.scene).to({y:this.camera.height-t[e].y-t[e].height},500)}}},e.prototype.checkHit=function(){for(var t=this.scene.roomBox[this.scene.player.roomNum-1],e=0;e<t.length;e++){var i=this.scene.hitTest(this.scene.player,t[e]);i&&t[e].type==playType.box&&this.scene.player.setHitobj(t[e],e)}},e.prototype.attackFrame=function(){for(var t=this.scene.roomBox[this.scene.player.roomNum-1],e=0;e<this.scene._bullet.length;e++)if(this.scene._bullet[e].isUse&&this.scene._bullet[e].btype==playType.cat)for(var i=0;i<t.length;i++){var n=this.scene.intersectTest(this.scene._bullet[e],t[i]);n&&(t[i].type==playType.box?(console.log("打错无辜的东西了！"),this.scene._bullet[e].recycle()):t[i].type==playType.mouse&&(console.log("打中了！"),this.scene._bullet[e].recycle(),t[i].back(),t.splice(i,1)))}},e.prototype.roomHide=function(){for(var t=0;t<this.scene.numChildren;t++){var e=this.scene.getChildAt(t);e.name==GameData.fixedType.room&&(e.visible=!1)}},e.prototype.handleLeft=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.moveFrame,this),this.scene.player.dir=-1,this.scene.player.startMove(),this.camera.cameraMove()},e.prototype.handleRight=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.moveFrame,this),this.scene.player.dir=1,this.scene.player.startMove(),this.camera.cameraMove()},e.prototype.handleMoveEnd=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.moveFrame,this),this.scene.player.stopMoveX(),this.camera.cStopMove()},e.prototype.handleUp=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.jumpFrame,this),this.scene.player.jump()},e.prototype.handleAttack=function(){var t=this.scene.getBullet();return void 0==t?void console.log("没得子弹咯"):(t.use(this.scene.player.type,this.scene.player.x,this.scene.player.y+20,this.scene.player.scaleX),void this.addEventListener(egret.Event.ENTER_FRAME,this.attackFrame,this))},e.prototype.handleCarry=function(){this.scene.player.takeup()},e.prototype.handleKeydown=function(t){switch(t.keyCode){case 65:this.handleLeft();break;case 68:this.handleRight();break;case 87:this.handleUp();break;case 75:this.handleAttack();break;case 49:case 50:case 51:case 52:this.scene.setplayer(t.keyCode-49)}},e.prototype.handleKeyup=function(t){(65==t.keyCode||68==t.keyCode)&&this.handleMoveEnd()},e}(eui.Component);__reflect(gameScene.prototype,"gameScene",["eui.UIComponent","egret.DisplayObject"]);var mainScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.start,this),this.playTG()},e.prototype.start=function(){console.log("开始匹配!"),this.stopTG(),this.dispatchEvent(new egret.Event("toMatch"))},e.prototype.playTG=function(){this.yun.addEventListener("complete",this.replay,this),this.yun.play()},e.prototype.stopTG=function(){this.yun.removeEventListener("complete",this.replay,this)},e.prototype.replay=function(){this.yun.play(0)},e}(eui.Component);__reflect(mainScene.prototype,"mainScene",["eui.UIComponent","egret.DisplayObject"]);var matchScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.backMS,this),this.testBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.toGS,this)},e.prototype.backMS=function(){console.log("返回主界面"),this.dispatchEvent(new egret.Event("backMain"))},e.prototype.toGS=function(){console.log("进入游戏界面"),this.dispatchEvent(new egret.Event("toGame"))},e}(eui.Component);__reflect(matchScene.prototype,"matchScene",["eui.UIComponent","egret.DisplayObject"]);var startScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.joinBtn.addEventListener("touchTap",this.showJoinPanel,this),this.joinRoomBtn.addEventListener("touchTap",this.handleClose,this),this.randomBtn.addEventListener("touchTap",this.randomJoin,this)},e.prototype.setText=function(t){this.logText.text+=t+"\n"},e.prototype.setUser=function(t){this.userAvatar.source=t.avatar,this.userId.text=t.id,this.userName.text=t.name},e.prototype.showJoinPanel=function(){this.joinRoom.visible=!0},e.prototype.handleClose=function(){""!=this.joinId.text&&(console.log(this.joinId.text),this.joinId.text=""),this.joinRoom.visible=!1},e.prototype.randomJoin=function(){GameData.engine.joinRandomRoom(3,"hi")},e}(eui.Component);__reflect(startScene.prototype,"startScene",["eui.UIComponent","egret.DisplayObject"]);