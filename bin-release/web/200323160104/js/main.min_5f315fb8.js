var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,o){function r(t){try{a(s.next(t))}catch(e){o(e)}}function h(t){try{a(s["throw"](t))}catch(e){o(e)}}function a(t){t.done?n(t.value):new i(function(e){e(t.value)}).then(r,h)}a((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return s([t,e])}}function s(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!(r=r.length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(s){i=[6,s],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,o,r,h,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},Scene=function(t){function e(){var e=t.call(this)||this;return e.roomBox=[],e.textureArr=[],e._bullet=[],e}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.hitTest=function(t,e){var i=t.x,s=t.y;this.checkAnchor(t)&&(i=t.x-t.width/2,s=t.y-t.height/2);var n=i+t.width,o=s+t.height,r=e.x-e.anchorOffsetX,h=e.y-e.anchorOffsetY;return n>r&&i<r+e.width&&o>h&&s<h+e.height?!0:!1},e.prototype.intersectTest=function(t,e){var i=0,s=0;this.checkAnchor(t)?i=t.height/2:(i=t.height,s=t.width/2);var n=t.x-t.anchorOffsetX+s,o=t.y-t.anchorOffsetY+i,r=e.x-e.anchorOffsetX,h=e.y-e.anchorOffsetY;return o>=h&&o<h+e.height&&n>r&&n<r+e.width?!0:!1},e.prototype.getByName=function(t,e){for(var i=[],s=0;s<t.numChildren;s++)t.getChildAt(s).name==e&&i.push(t.getChildAt(s));return i},e.prototype.boxTest=function(t){for(var e=this.getChildAt(t.roomNum),i=[],s=0;s<e.numChildren;s++){var n=e.getChildAt(s),o=new egret.DisplayObject;o.x=e.x+n.x,o.y=e.y+n.y,o.width=n.width,o.height=n.height,o.anchorOffsetX=n.anchorOffsetX,o.anchorOffsetY=n.anchorOffsetY,o.name=n.name,this.intersectTest(t,o)&&i.push(o)}return i},e.prototype.checkRoom=function(t){for(var e=0;e<this.numChildren;e++)if("room"==this.getChildAt(e).name){var i=this.intersectTest(t,this.getChildAt(e));if(i&&t.roomNum!=e){if(t.type==playType.mouse)for(var s=this.roomBox[t.roomNum-1],n=s.length-1;n>=0;n--)if(s[n]==t){s.splice(n,1);break}t.roomNum=e,this.roomBox[t.roomNum-1].push(t);break}}},e.prototype.random_texture=function(){for(var t=this.random(1,this.textureArr.length-1);this.textureArr[t].length<1;)t=this.random(1,this.textureArr.length-1);var e=this.random(0,this.textureArr[t].length-1);return{a:t,b:e}},e.prototype.random_roomnum=function(){return this.random(1,this.rooms)},e.prototype.random_position=function(){var t=this.random_roomnum(),e=this.getChildAt(t),i=this.random(e.x,e.x+e.width-50),s=e.y+e.height-80;return{x:i,y:s,nr:t}},e.prototype.random_roomposition=function(t){void 0==t&&(t=this.random_roomnum());var e=this.getChildAt(t),i=e.getChildAt(this.random(0,e.numChildren-1)),s=this.random(e.x+i.x,e.x+i.x+i.width),n=e.y+i.y;return{x:s,y:n,nr:t}},e.prototype.random=function(t,e){return Math.round(Math.random()*(e-t)+t)},e.prototype.checkAnchor=function(t){return t.type==playType.cat?!0:!1},e}(eui.Component);__reflect(Scene.prototype,"Scene");var renwu=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(t){this._main=t},e.prototype.showResult=function(t){var e=0;for(var i in t)if(t[i].finish){var s=this._main.getByName(this.getChildAt(e),"ok");s[0].visible=!0,e++}},e}(eui.Component);__reflect(renwu.prototype,"renwu",["eui.UIComponent","egret.DisplayObject"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,8,,9]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),[4,RES.getResByUrl("resource/assets/images/scorefont.fnt",this.onLoadFont,this,RES.ResourceItem.TYPE_FONT)];case 4:return i.sent(),[4,RES.getResByUrl("resource/assets/images/timefont.fnt",this.onLoadTFont,this,RES.ResourceItem.TYPE_FONT)];case 5:return i.sent(),[4,RES.getResByUrl("resource/assets/images/timefonth.fnt",this.onLoadTWFont,this,RES.ResourceItem.TYPE_FONT)];case 6:return i.sent(),[4,RES.getResByUrl("resource/assets/images/mainfont.fnt",this.onLoadMFont,this,RES.ResourceItem.TYPE_FONT)];case 7:return i.sent(),this.stage.removeChild(t),[3,9];case 8:return e=i.sent(),console.error(e),[3,9];case 9:return[2]}})})},e.prototype.onLoadFont=function(t){font=t},e.prototype.onLoadTFont=function(t){timefont=t},e.prototype.onLoadTWFont=function(t){timefontwarn=t},e.prototype.onLoadMFont=function(t){mainfont=t},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var s=new eui.Theme("resource/default.thm.json",t.stage);s.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){this.matchvs=new MsEngine,this.ms=new mainScene(this.matchvs),this.mcs=new matchScene(this.matchvs),this.addChild(this.ms),this.ms.addEventListener("toMatch",this.switchScene,this),this.mcs.addEventListener("backMain",this.backScene,this),this.mcs.addEventListener("toGame",this.createData,this)},e.prototype.createData=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.gs=new gameScene,this.addChild(this.gs),[4,this.gs.createGame()];case 1:return t.sent(),this.gs.init(),[2]}})})},e.prototype.switchScene=function(){this.addChild(this.mcs)},e.prototype.backScene=function(){this.ms.playTG(),this.removeChild(this.mcs)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var MsEngine=function(){function t(){var t=this;this.initRespone=function(e){200==e?(console.log("初始化成功"),t.engine.registerUser()):console.log("初始化失败")},this.registerRespone=function(e){0==e.status?(console.log("注册成功！"),t.username=e.name,t.usertoken=e.token,t.userid=e.userID,t.useravatar=e.avatar,t.login()):console.log("注册失败！")},this.loginResponse=function(t){200==t.status?console.log("登陆成功！"):console.log("登陆失败！")},this.engine=new MatchvsEngine,this.response=new MatchvsResponse,this.response.initResponse=this.initRespone,this.response.registerUserResponse=this.registerRespone,this.engine.init(this.response,GameData.channel,GameData.environment.dev,GameData.GameID,GameData.Appkey,GameData.GameVersion)}return t.prototype.login=function(){console.log("登陆中"),this.engine.login(this.userid,this.usertoken,"deviceID")},t.prototype.randomJoin=function(){var t=this.username+","+this.useravatar;this.engine.joinRandomRoom(4,t)},t}();__reflect(MsEngine.prototype,"MsEngine");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,s){function n(t){e.call(s,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(s))}var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(s,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(s,generateEUI2)},r)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var h=t.split("/");h.pop();var a=h.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(s,generateJSON.paths[t])},this):RES.getResByUrl(a,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(s,generateJSON.paths[t])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(s,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Bullet=function(t){function e(e){var i=t.call(this)||this;return i.isUse=!1,i.width=GameData.gameconfig.bwidth,i.height=GameData.gameconfig.bheight,i._main=e,i._bulletImg=new eui.Image,i._bulletImg.width=i.width,i._bulletImg.height=i.height,i.addChild(i._bulletImg),i}return __extends(e,t),e.prototype.frame=function(){this.isUse&&this.btype==playType.cat&&(this.x+=this._speed,this.x==this.endX&&this.recycle())},e.prototype.use=function(t,e,i,s){this.isUse=!0,this.x=e-30*s,this.y=i,this.btype=t,this._speed=-15*s,this.endX=this.x+20*this._speed,t==playType.cat&&(this._bulletImg.source="attackTextrue"),this._main.addChild(this),this.addEventListener(egret.Event.ENTER_FRAME,this.frame,this)},e.prototype.recycle=function(){this.isUse=!1,this._main.removeChild(this),this.removeEventListener(egret.Event.ENTER_FRAME,this.frame,this)},e}(eui.Component);__reflect(Bullet.prototype,"Bullet");var Camera=function(t){function e(e,i){var s=t.call(this)||this;return s.m_width=e,s.m_height=i,s.m_cameraOffsetX=0,s.m_cameraOffsetY=0,s}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(t){this.m_container=t,this.m_zoomX=this.m_container.x,this.m_zoomY=this.m_container.y},e.prototype.setAnchor=function(){null!=this.m_container&&(this.setPosition(),this.m_zoomX=this.m_follower.x,this.m_zoomY=this.m_follower.y)},e.prototype.setPosition=function(){var t=this.m_container.getChildAt(this.m_follower.roomNum),e=t.y,i=e+t.height-this.m_height,s=t.x,n=s+t.width-this.m_width,o=this.m_follower.x-this.m_width/2,r=this.m_follower.y-this.m_height/2;s>o?o=s:o>n&&(o=n),e>r?r=e:r>i&&(r=i),this.m_container.x=-o,this.m_container.y=-r},e.prototype.setZoom=function(t){null!=this.m_container&&(this.m_container.scaleX=t,this.m_container.scaleY=t)},e.prototype.setRotation=function(t){null!=this.m_container&&(this.m_container.rotation=t)},e.prototype.follow=function(t){null!=this.m_container&&(this.m_follower=t,this.m_zoomX=this.m_follower.x,this.m_zoomY=this.m_follower.y,this.m_cameraOffsetY=this.m_follower.speedY,this.setAnchor())},e.prototype.followCenterX=function(){var t=this.x-this.m_container.x+this.m_width/2-10,e=this.x-this.m_container.x+this.m_width/2+10;return this.m_cameraOffsetX>0&&this.m_follower.x>e||this.m_cameraOffsetX<0&&this.m_follower.x<t?!0:!1},e.prototype.cameraMove=function(){this.m_cameraOffsetX=this.m_follower.speedX*this.m_follower.dir,this.addEventListener(egret.Event.ENTER_FRAME,this.move,this)},e.prototype.cStopMove=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.move,this)},e.prototype.cameraFall=function(){var t=this.m_container.getChildAt(this.m_follower.roomNum),e=t.y+t.height,i=this.y-this.m_container.y,s=this.m_follower,n=Math.round(this.y+this.m_height/3*2-this.m_container.y);i<e-this.m_height&&s.y>n&&(this.m_container.y-=this.m_cameraOffsetY)},e.prototype.cameraUp=function(){var t=this.m_container.getChildAt(this.m_follower.roomNum),e=t.y,i=(t.y+t.height,this.m_follower.y),s=Math.round(this.y+this.m_height/3-this.m_container.y),n=Math.round(this.y+this.m_height/3*2-this.m_container.y);Math.round(this.y+this.m_height-this.m_container.y);if(s>i){var o=this.y-this.m_container.y-e<n-this.m_follower.y?this.y-this.m_container.y-e:n-this.m_follower.y;egret.Tween.get(this.m_container).to({y:this.m_container.y+o},500)}},e.prototype.move=function(){var t=this.m_container.x,e=t+this.m_container.width,i=0,s=this.m_width;(this.m_cameraOffsetX>0&&e>s&&this.followCenterX()||this.m_cameraOffsetX<0&&i>t&&this.followCenterX())&&(this.m_container.x-=this.m_cameraOffsetX)},e}(eui.Component);__reflect(Camera.prototype,"Camera",["eui.UIComponent","egret.DisplayObject"]);var miniPlayer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.init=function(t){this._main=t,this.numD=0},e.prototype.showResult=function(t){for(var e=1,i=0;i<t.length;i++)if(t[i].type==playType.mouse){if(t[i].die){var s=this._main.getByName(this.getChildAt(e),"die");s[0].visible=!0}e++}},e}(eui.Component);__reflect(miniPlayer.prototype,"miniPlayer",["eui.UIComponent","egret.DisplayObject"]);var Player=function(t){function e(){var e=t.call(this)||this;return e.dir=-1,e.mc=new egret.MovieClip,e.addChild(e.mc),e}return __extends(e,t),e.prototype.init=function(){var t=new egret.MovieClipDataFactory(RES.getRes("cat_mc_json"),RES.getRes("cat_tex_png"));this.mc.setMovieClipData(t.generateMovieClipData("猫猫动画")),this.width=this.mc.width,this.height=this.mc.height,this.anchorOffsetX=0,this.anchorOffsetY=0,this.jumpSpeed=GameData.gameconfig.pjumpspeed,this.speedX=GameData.gameconfig.pspeedx,this.speedY=GameData.gameconfig.pspeeedy,this.scaleX=1,this.canFall=!0,this.isJump=!1,this.score=0,this.value=100},e.prototype.scale=function(){this.scaleX=this.dir>0?-1:1},e.prototype.playMC=function(){this.mc.isPlaying||this.mc.gotoAndPlay(0,-1)},e.prototype.moveX=function(){this.parent&&this.x>this.parent.x-this.speedX*this.dir&&this.x<this.parent.width-this.speedX*this.dir&&(this.x+=this.speedX*this.dir)},e.prototype.jump=function(){var t=this;this.isJump||(this.isJump=!0,egret.Tween.get(this).to({y:this.y-this.jumpSpeed},500,egret.Ease.quartOut).call(function(){t.canFall=!0,t.addEventListener(egret.Event.ENTER_FRAME,t.fall,t)}))},e.prototype.fall=function(){if(this.parent){var t=this.parent.getChildAt(this.roomNum),e=t.y+t.height;this.canFall&&this.y<e&&(this.y+=this.speedY)}},e.prototype.startMove=function(){this.type==playType.cat&&this.scale(),this.playMC(),this.addEventListener(egret.Event.ENTER_FRAME,this.moveX,this)},e.prototype.stopMoveX=function(){this.mc.gotoAndStop(0),this.removeEventListener(egret.Event.ENTER_FRAME,this.moveX,this)},e.prototype.chage=function(){this.removeChild(this.mc),this.playObj=new eui.Image(this.ptexture),this.playObj.width=this.ptexture.textureWidth,this.playObj.height=this.ptexture.textureHeight,this.width=this.playObj.width,this.height=this.playObj.height,this.y-=this.mc.height/2,this.die=!1,this.addChild(this.playObj)},e.prototype.back=function(){var t=this;this.removeChild(this.playObj),this.width=this.mc.width,this.height=this.mc.height,this.addChild(this.mc),this.die=!0,this.score=0;var e=this.parent.parent;e&&e.playerCollection.itemUpdated(this),egret.setTimeout(function(){t.parent.removeChild(t)},this,1e3)},e.prototype.setHitobj=function(t,e){null==this.hitBox&&(this.hitBox=t,this.hitBoxIndex=e,this.hitBox.addfilter(),this.addEventListener(egret.Event.ENTER_FRAME,this.checkHit,this))},e.prototype.checkHit=function(){var t=this.parent;t&&(t.hitTest(this,this.hitBox)||(this.hitBox.removefilter(),this.hitBox=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.checkHit,this)))},e.prototype.takeup=function(){var t=this.parent;if(null==this.carryObj){if(null==this.hitBox)return;this.carryObj=this.hitBox,t.roomBox[t.player.roomNum-1].splice(this.hitBoxIndex,1),this.addEventListener(egret.Event.ENTER_FRAME,this.carryMove,this)}else this.removeEventListener(egret.Event.ENTER_FRAME,this.carryMove,this),this.carryObj.roomNum=t.player.roomNum,t.roomBox[this.carryObj.roomNum-1].push(this.carryObj),this.carryObj.checkFall(),this.carryObj=null},e.prototype.putoff=function(){this.carryObj=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.carryMove,this)},e.prototype.carryMove=function(){this.carryObj.x=this.x,this.carryObj.y=this.y-this.carryObj.height},e}(eui.Component);__reflect(Player.prototype,"Player");var GameData=function(){function t(){}return t.channel="Matchvs",t.environment={dev:"alpha",pro:"release"},t.GameID=217622,t.Appkey="fe20841e73df41d794f15891c940a306#E",t.Secret="233020558933484a97895e34eaf1589a",t.GameVersion=1,t.stageWidth=1136,t.stageHeight=640,t.gameconfig={bNum:20,bwidth:30,bheight:30,pNum:4,pspeedx:10,pspeeedy:10,pjumpspeed:150,sNum:4,rwscore:75,catchscore:100},t.fixedType={room:"room",nfloor:"newFloor"},t}();__reflect(GameData.prototype,"GameData");var playType;!function(t){t[t.cat=0]="cat",t[t.mouse=1]="mouse",t[t.box=2]="box"}(playType||(playType={}));var font,timefont,timefontwarn,mainfont,gamedata={},Result=function(t){function e(e){var i=t.call(this)||this;return i._main=e,i._bg=new eui.Rect(GameData.stageWidth,GameData.stageHeight,8879214),i._bg.alpha=.7,i._showView=new egret.MovieClip,i}return __extends(e,t),e.prototype.setbg=function(){this.addChild(this._bg)},e.prototype.shengli=function(){var t=new egret.MovieClipDataFactory(RES.getRes("sl_tex_json"),RES.getRes("sl_tex_png"));this._showView.setMovieClipData(t.generateMovieClipData("胜利"))},e.prototype.shibai=function(){var t=new egret.MovieClipDataFactory(RES.getRes("shib_mc_json"),RES.getRes("shib_tex_png"));this._showView.setMovieClipData(t.generateMovieClipData("shib"))},e.prototype.showResult=function(t){this.setbg(),t?this.shengli():this.shibai(),this._showView.x=GameData.stageWidth/2,this._showView.y=GameData.stageHeight/2,this.addChild(this._showView),this._main.addChild(this),this._showView.play()},e}(eui.Component);__reflect(Result.prototype,"Result");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function s(s){e.call(i,s,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?s(n):RES.getResAsync(t,s,this)}else RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var scene1=function(t){function e(e){var i=t.call(this)||this;return i.gamedata=GameData.gameconfig,i._sTexture={1:"s1l1_json",2:null,3:"s1r1_json",4:"s1l2_json",5:"s1r2_json"},i._main=e,i}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rooms=this.findRoom();for(var e=0;e<this.rooms;e++)this.roomBox[e]=[];this.getTexture(),this.initPool()},e.prototype.init=function(){this.createNPC(gamedata.sbox),this.createSticker(),this.createPlayer()},e.prototype.getTexture=function(){for(var t in this._sTexture)if(this.textureArr[t]=[],null!=this._sTexture[t]){var e=RES.getRes(this._sTexture[t])._textureMap;for(var i in e)this.textureArr[t].push(e[i])}},e.prototype.createNPC=function(t){for(var e=0;e<t.length;e++){var i=t[e],s=new SmallObj(this);s.setView(this.textureArr[i.texture.a][i.texture.b]),s.roomNum=i.roomNum,s.x=i.x-s.width,s.y=i.y-s.height,this.roomBox[s.roomNum-1].push(s),this.addChild(s)}},e.prototype.createPlayer=function(){for(var t=gamedata.person,e=0;e<t.length;e++){var i=new Player;i.init(),i.roomNum=t[e].roomNum,i.x=t[e].x,i.y=t[e].y,i.type=t[e].type,i.type!=playType.cat&&(i.ptexture=this.textureArr[t[e].playObj.a][t[e].playObj.a],i.chage(),this.roomBox[i.roomNum-1].push(i)),this._main.playerCollection.addItem(i),this.addChild(i),console.log(i.roomNum)}this.player=this._main.playerCollection.getItemAt(0)},e.prototype.setplayer=function(t){this.player=this._main.playerCollection.getItemAt(t)},e.prototype.initPool=function(){for(var t=0;t<this.gamedata.bNum;t++){var e=new Bullet(this);this._bullet.push(e)}},e.prototype.getBullet=function(){for(var t=0;t<this._bullet.length;t++)if(0==this._bullet[t].isUse)return this._bullet[t];console.log("子弹已经用光")},e.prototype.findRoom=function(){for(var t=0,e=0;e<this.numChildren;e++)this.getChildAt(e).name==GameData.fixedType.room&&t++;return t},e.prototype.createSticker=function(){for(var t=gamedata.sticker,e=this.parent,i=0;i<t.length;i++){var s=new Sticker(this),n=t[i].texture;s.addMask(this.textureArr[n.a][n.b]),s.x=t[i].x-s.width,s.y=t[i].y-s.height,s.roomNum=t[i].roomNum,this.addChild(s),e&&e.stickerCollection.addItem(s)}},e}(Scene);__reflect(scene1.prototype,"scene1",["eui.UIComponent","egret.DisplayObject"]);var Score=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this._score=0,this._text=new egret.BitmapText,this._text.font=font,this._text.x=25,this._text.y=25,this.addChild(this._text),this.showScore()},e.prototype.setScore=function(t){this._score=t,0!=this._score&&(this._text.x=10),this.showScore()},e.prototype.showScore=function(){this._text.text=this._score},e.prototype.addScoreTip=function(t){var e=this,i=new eui.BitmapLabel;i.font=font,i.text=t>0?"+"+t:t,i.y=50,i.x=80,this.addChild(i),egret.Tween.get(i).to({y:20,alpha:.5},1e3).call(function(){e.removeChild(i)})},e}(eui.Component);__reflect(Score.prototype,"Score",["eui.UIComponent","egret.DisplayObject"]);var SmallObj=function(t){function e(e){var i=t.call(this)||this;return i.isUse=!1,i.anchorOffsetX=0,i.anchorOffsetY=0,i._main=e,i._displayView=new eui.Image,i.type=playType.box,i.addChild(i._displayView),i}return __extends(e,t),e.prototype.setView=function(t){this._displayView.source=t,this.width=t.textureWidth,this.height=t.textureHeight},e.prototype.addfilter=function(){var t=[1,0,0,0,100,0,1,0,0,100,0,0,1,0,100,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);this.filters=[e]},e.prototype.checkHit=function(){var t=this.parent;t&&(t.hitTest(this.hitObj,this)||(this.removefilter(),this.hitObj=null,this.removeEventListener(egret.Event.ENTER_FRAME,this.checkHit,this)))},e.prototype.removefilter=function(){this.filters=null},e.prototype.checkFall=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.fall,this),this.dispatchEvent(new egret.Event("soFall"))},e.prototype.fall=function(){var t=this.parent;t&&(t.boxTest(this).length>0?this.removeEventListener(egret.Event.ENTER_FRAME,this.fall,this):this.y+=5)},e}(eui.Component);__reflect(SmallObj.prototype,"SmallObj");var Sticker=function(t){function e(e){var i=t.call(this)||this;return i._main=e,i.anchorOffsetX=0,i.anchorOffsetY=0,i._tip=new eui.Image("tip"),i.finish=!1,i.value=GameData.gameconfig.rwscore,i}return __extends(e,t),e.prototype.addMask=function(t){this._displayView=new eui.Image,this._texture=t,this._displayView.source=t,this._displayView.width=t.textureWidth,this._displayView.height=t.textureHeight,this._displayView.x=0,this._displayView.y=0,this.width=this._displayView.width,this.height=this._displayView.height,this.maskRect=new eui.Rect(this._displayView.width,this._displayView.height,4473410),this.maskRect.mask=this._displayView,this.maskRect.x=0,this.maskRect.y=0,this.addChild(this.maskRect),this.addChild(this._displayView),this.addEventListener(egret.Event.ENTER_FRAME,this.stickerHit,this)},e.prototype.removeMask=function(){this.maskRect.mask=null,this.removeChild(this.maskRect),this.removeEventListener(egret.Event.ENTER_FRAME,this.stickerHit,this)},e.prototype.showTip=function(){this.addChild(this._tip),this._tip.y=-this._tip.height,this._tip.x=-this._tip.width/2+this._displayView.width/2},e.prototype.hidTip=function(){this.removeChild(this._tip)},e.prototype.showResult=function(){this._tipr=new eui.Image("tipr"),this.addChild(this._tipr),this._tipr.y=-this._tipr.height,this._tipr.x=-this._tipr.width/2+this._displayView.width/2,this.finish=!0;var t=this._main.parent;t.stickerCollection.itemUpdated(this)},e.prototype.stickerHit=function(){var t=this._main.parent,e=t.playerCollection.source;if(null==this.hitPerson){for(var i in e)if(this._main.hitTest(e[i],this)&&e[i].type==playType.mouse){this.hitPerson=i,null!=e[i].carryObj&&(this.compareObj=e[i].carryObj),this.showTip();break}}else null==e[this.hitPerson].carryObj&&null!=this.compareObj&&this._main.hitTest(this.compareObj,this)&&this.compareObj._displayView.source==this._texture&&(e[this.hitPerson].score+=this.value,t.scoreTip.addScoreTip(this.value),t.playerCollection.itemUpdated(e[this.hitPerson]),this.removeMask(),this.showResult(),this._main.roomBox[this.compareObj.roomNum-1].pop(),this._main.removeChild(this.compareObj)),this._main.hitTest(e[this.hitPerson],this)||(this.hidTip(),this.hitPerson=null)},e}(eui.Component);__reflect(Sticker.prototype,"Sticker");var Timer=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._text=new egret.BitmapText,this._text.font=timefont,this.addChild(this._text),this._text.x=27,this._text.y=10,this._timer=new egret.Timer(1e3)},e.prototype.startTimer=function(t){this._initTime=t,this.showText(this._initTime),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start()},e.prototype.onTimer=function(){this._initTime>0?(this._initTime--,this.showText(this._initTime)):this.onComplete()},e.prototype.onComplete=function(){this._timer.stop(),console.log("时间到！"),this.setGameResult()},e.prototype.setGameResult=function(){if(!this._main.gameOver){this._main.gameOver=!0;var t=0,e=0,i=this._main.playerCollection.source;for(var s in i)i[s].type==playType.cat?t+=i[s].score:i[s].type==playType.mouse&&(e+=i[s].score);this._main.winner=t>e?playType.cat:playType.mouse,new Result(this._main).showResult(this._main.winner==this._main.scene.player.type)}},e.prototype.showText=function(t){var e=Math.floor(t/60),i=t-60*e;1>e&&31>i&&(this._text.font=timefontwarn),this._text.text=e+":"+i},e}(eui.Component);__reflect(Timer.prototype,"Timer",["eui.UIComponent","egret.DisplayObject"]);var Tip=function(t){function e(e){var i=t.call(this)||this;return i.textTexture={cat:"t1",mouse:"t2"},i._main=e,i}return __extends(e,t),e.prototype.show=function(){this._bg=new eui.Rect(GameData.stageWidth,GameData.stageHeight,8879214),this._bg.alpha=.7,this.addChild(this._bg),this.showText(),egret.setTimeout(this.hiden,this,3e3)},e.prototype.showText=function(){this._text=this._main.scene.player.type==playType.cat?new eui.Image(this.textTexture.cat):new eui.Image(this.textTexture.mouse),this._text.x=300,this._text.y=200,this.addChild(this._text)},e.prototype.hiden=function(){this.removeChild(this._bg),this.removeChild(this._text),this._main.removeChild(this)},e}(eui.Component);__reflect(Tip.prototype,"Tip");var gameScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.createGame=function(){gamedata.scene=1,this.createGS();for(var t=[],e=[],i=[],s=GameData.gameconfig.pNum,n=this.scene.random(0,s-1),o=0;s>o;o++){var r=new Object,h=this.scene.random_position();r.roomNum=h.nr,r.x=h.x,r.y=h.y,o!=n?(r.type=playType.mouse,r.playObj=this.scene.random_texture()):r.type=playType.cat,e.push(r)}gamedata.person=e;for(var o=0;o<this.scene.rooms;o++){if(this.scene.textureArr[o+1].length>0){var a=new Object,c=this.scene.random(0,this.scene.textureArr[o+1].length-1);a.texture={a:o+1,b:c},a.roomNum=o+1;var h=this.scene.random_roomposition(a.roomNum);a.x=h.x,a.y=h.y,i.push(a);var l=new Object;l.texture=a.texture;for(var p=this.scene.random_roomposition();p.nr==o+1;)p=this.scene.random_roomposition();l.roomNum=p.nr,l.x=p.x,l.y=p.y,t.push(l)}for(var u=this.scene.random(4,12),m=0;u>m;m++){var d=new Object;d.texture=this.scene.random_texture(),d.roomNum=o+1;var h=this.scene.random_roomposition(d.roomNum);d.x=h.x,d.y=h.y,t.push(d)}}gamedata.sticker=i,gamedata.sbox=t},e.prototype.createGS=function(){switch(gamedata.scene){case 1:this.scene=new scene1(this)}this.addChild(this.scene)},e.prototype.init=function(){this.stickerCollection=new eui.ArrayCollection([]),this.playerCollection=new eui.ArrayCollection([]),this.scene.init(),this.camera=new Camera(GameData.stageWidth,GameData.stageHeight),this.camera.init(this.scene),this.camera.follow(this.scene.player),this.addChild(this.camera),this.setChildIndex(this.controlGroup,999),this.roomHide(),this.initEvent(),this.gameOver=!1,this.timer._main=this,this.timer.startTimer(120),this.rwTip.init(this.scene),this.mpTip.init(this.scene),this.tip=new Tip(this),this.tip.show(),this.addChild(this.tip),this.stickerCollection.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.handlesticker,this),this.playerCollection.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,this.handleplayer,this)},e.prototype.initEvent=function(){var t=this;this.leftBtn.addEventListener("touchBegin",this.handleLeft,this),this.leftBtn.addEventListener("touchReleaseOutside",this.handleMoveEnd,this),this.leftBtn.addEventListener("touchEnd",this.handleMoveEnd,this),this.rightBtn.addEventListener("touchBegin",this.handleRight,this),this.rightBtn.addEventListener("touchReleaseOutside",this.handleMoveEnd,this),this.rightBtn.addEventListener("touchEnd",this.handleMoveEnd,this),this.upBtn.addEventListener("touchBegin",this.handleUp,this),this.attackBtn.addEventListener("touchBegin",this.handleAttack,this),this.carryBtn.addEventListener("touchBegin",this.handleCarry,this),document.addEventListener("keydown",function(e){return t.handleKeydown(e)},!1),document.addEventListener("keyup",function(e){return t.handleKeyup(e)},!1)},e.prototype.moveFrame=function(){this.scene.checkRoom(this.scene.player);var t=this.scene.boxTest(this.scene.player);t.length<=0&&(this.scene.player.canFall=!0,this.jumpFrame()),this.checkHit()
},e.prototype.jumpFrame=function(){if(this.checkHit(),this.scene.player.canFall){this.camera.cameraFall();var t=void 0;if(t=this.scene.boxTest(this.scene.player),t.length>0){this.scene.player.canFall=!1,this.scene.player.isJump=!1,this.camera.cameraUp();for(var e=0;e<t.length;e++)t[e].name&&t[e].name==GameData.fixedType.nfloor&&egret.Tween.get(this.scene).to({y:this.camera.height-t[e].y-t[e].height},500)}}},e.prototype.checkHit=function(){for(var t=this.scene.roomBox[this.scene.player.roomNum-1],e=0;e<t.length;e++){var i=this.scene.hitTest(this.scene.player,t[e]);i&&t[e].type==playType.box&&this.scene.player.setHitobj(t[e],e)}},e.prototype.attackFrame=function(){for(var t=this.scene.roomBox[this.scene.player.roomNum-1],e=0;e<this.scene._bullet.length;e++)if(this.scene._bullet[e].isUse&&this.scene._bullet[e].btype==playType.cat)for(var i=0;i<t.length;i++){var s=this.scene.intersectTest(this.scene._bullet[e],t[i]);s&&(t[i].type==playType.box?(console.log("打错无辜的东西了！"),this.scene._bullet[e].recycle(),this.scene.player.score-=50,this.scoreTip.addScoreTip(-50)):t[i].type==playType.mouse&&(console.log("打中了！"),this.scene.player.score+=t[i].score,this.scene.player.score+=t[i].value,this.scoreTip.addScoreTip(t[i].score+t[i].value),this.scene._bullet[e].recycle(),t[i].back(),t.splice(i,1)),this.playerCollection.itemUpdated(this.scene.player))}},e.prototype.roomHide=function(){for(var t=0;t<this.scene.numChildren;t++){var e=this.scene.getChildAt(t);e.name==GameData.fixedType.room&&(e.visible=!1)}},e.prototype.checkGameOver=function(){if(this.gameOver||(this.gameOver=this.stickerCollection.source.every(function(t){return 1==t.finish}),this.gameOver&&(this.winner=playType.mouse)),!this.gameOver){for(var t=!0,e=0;e<this.playerCollection.source.length;e++)this.playerCollection.source[e].type==playType.mouse&&0==this.playerCollection.source[e].die&&(t=!1);this.gameOver=t,this.gameOver&&(this.winner=playType.cat)}this.gameOver&&(this.timer.onComplete(),new Result(this).showResult(this.winner==this.scene.player.type))},e.prototype.handlesticker=function(t){this.scoreTip.setScore(this.scene.player.score),this.rwTip.showResult(t.target.source),this.checkGameOver()},e.prototype.handleplayer=function(t){var e=[];for(var i in this.playerCollection.source)e.push(this.playerCollection.source[i].score);console.log(e),this.mpTip.showResult(t.target.source),this.scoreTip.setScore(this.scene.player.score),this.checkGameOver()},e.prototype.handleLeft=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.moveFrame,this),this.scene.player.dir=-1,this.scene.player.startMove(),this.camera.cameraMove()},e.prototype.handleRight=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.moveFrame,this),this.scene.player.dir=1,this.scene.player.startMove(),this.camera.cameraMove()},e.prototype.handleMoveEnd=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.moveFrame,this),this.scene.player.stopMoveX(),this.camera.cStopMove()},e.prototype.handleUp=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.jumpFrame,this),this.scene.player.jump()},e.prototype.handleAttack=function(){var t=this.scene.getBullet();return void 0==t?void console.log("没得子弹咯"):(t.use(this.scene.player.type,this.scene.player.x,this.scene.player.y+20,this.scene.player.scaleX),void this.addEventListener(egret.Event.ENTER_FRAME,this.attackFrame,this))},e.prototype.handleCarry=function(){this.scene.player.takeup()},e.prototype.handleKeydown=function(t){switch(t.keyCode){case 65:this.handleLeft();break;case 68:this.handleRight();break;case 87:this.handleUp();break;case 75:this.handleAttack();break;case 49:case 50:case 51:case 52:this.scene.setplayer(t.keyCode-49),this.scoreTip.setScore(this.scene.player.score),this.camera.follow(this.scene.player)}},e.prototype.handleKeyup=function(t){(65==t.keyCode||68==t.keyCode)&&this.handleMoveEnd()},e}(eui.Component);__reflect(gameScene.prototype,"gameScene",["eui.UIComponent","egret.DisplayObject"]);var mainScene=function(t){function e(e){var i=t.call(this)||this;return i.loginResponse=function(t){if(200==t.status){console.log("登陆成功！");var e=new eui.BitmapLabel;e.font=mainfont,e.text=i._matchvs.username,e.y=38,e.x=166.5;var s=i.getChildAt(7);s.addChild(e);var n=new eui.BitmapLabel;n.font=mainfont,n.text=i._matchvs.userid,n.y=2,n.x=144,s.addChild(n),i.utx.source=i._matchvs.useravatar}else console.log("登陆失败！")},i._matchvs=e,i}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.start,this),this.playTG(),this._matchvs.response.loginResponse=this.loginResponse},e.prototype.start=function(){console.log("开始匹配!"),this.stopTG(),this._matchvs.randomJoin(),this.dispatchEvent(new egret.Event("toMatch"))},e.prototype.playTG=function(){this.yun.addEventListener("complete",this.replay,this),this.yun.play()},e.prototype.stopTG=function(){this.yun.removeEventListener("complete",this.replay,this)},e.prototype.replay=function(){this.yun.play(0)},e}(eui.Component);__reflect(mainScene.prototype,"mainScene",["eui.UIComponent","egret.DisplayObject"]);var matchScene=function(t){function e(e){var i=t.call(this)||this;return i.roomList=[],i.joinResponse=function(t,e,s){if(200==t){if(console.log("已加入房间"),console.log(e),console.log(s),i.rid.text=s.roomID,i.rowerID.text=i._matchvs.username,i.rowerTX.source=i._matchvs.useravatar,e.length>0){var n=e[0].userProfile.split(","),o={};o.userID=e[0].userId,o.username=n[0],o.useravatar=n[1],i.roomList.push(o),i.rlTX.source=o.useravatar,i.rlID.text=o.username}}else console.log("加入失败，请重试")},i.otherJoin=function(t){console.log(t);var e=t.userProfile.split(","),s={};s.userID=t.userId,s.username=e[0],s.useravatar=e[1],i.roomList.push(s),i.rlTX.source=s.useravatar,i.rlID.text=s.username},i._matchvs=e,i}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.backMS,this),this.testBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.toGS,this),this._matchvs.response.joinRoomResponse=this.joinResponse,this._matchvs.response.joinRoomNotify=this.otherJoin},e.prototype.backMS=function(){console.log("返回主界面"),this.dispatchEvent(new egret.Event("backMain"))},e.prototype.toGS=function(){console.log("进入游戏界面"),this.dispatchEvent(new egret.Event("toGame"))},e}(eui.Component);__reflect(matchScene.prototype,"matchScene",["eui.UIComponent","egret.DisplayObject"]);